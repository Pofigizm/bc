"use strict";angular.module("bcApp",["ngCookies","ngResource","ngRoute"]).config(["$routeProvider","$locationProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/user",{templateUrl:"views/user.html",controller:"UserCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","$http","apiurl",function(a,b,c,d){c({method:"GET",withCredentials:!0,url:d+"user.json",headers:{"Content-Type":"application/json"}}).success(function(c){c.id?(a.currentUser={auth:!0,id:c.id,name:c.username},b.path("/")):(a.currentUser=null,b.path("/"))})}]),angular.module("bcApp").controller("LoginCtrl",["$scope","$http","apiurl","$location","$rootScope",function(a,b,c,d,e){a.user={name:"test@odesk2.com",password:"password"},a.error=!1,a.hideErr=function(){a.error=!1},a.doLogin=function(){a.submitted=!0;var f=JSON.stringify({username:a.user.name,password:a.user.password});b({method:"POST",withCredentials:!0,url:c+"auth",headers:{"Content-Type":"application/json; charset=utf-8"},data:f}).success(function(a){e.currentUser={auth:!0,id:a.id,name:a.username},d.path("/user")}).error(function(){e.currentUser=null,a.error=!0})}}]),angular.module("bcApp").controller("MainCtrl",["$scope",function(){}]),angular.module("bcApp").controller("NavbarCtrl",["$scope","$location","$http","$rootScope","apiurl","$timeout",function(a,b,c,d,e,f){a.logout=function(){c({method:"GET",withCredentials:!0,url:e+"logout",headers:{"Content-Type":"application/json","Cache-Control":"no-cache"}}),d.currentUser=null,f(function(){b.path("/")},1e3)}}]),angular.module("bcApp").controller("UserCtrl",["$scope","$http","apiurl","$rootScope","$location","$timeout",function(a,b,c,d,e,f){function g(a,d){b({method:"GET",withCredentials:!0,url:c+"org/"+a.id+"/user/"+a.name+".json",headers:{"Content-Type":"application/json; charset=utf-8"}}).success(function(){return d.apply(null,arguments)}).error(function(){return d.apply(null)})}function h(a,d,e){b({method:"POST",withCredentials:!0,url:c+"user/"+a.id,headers:{"Content-Type":"application/json; charset=utf-8"},data:JSON.stringify(d)}).success(function(){return e.apply(null,arguments)}).error(function(){return e.apply(null)})}d.currentUser||e.path("/"),a.doLoad=function(){g(d.currentUser,function(b){b||e.path("/"),a.userdata=b,a.contentExist=!0,a.newdata={firstName:b.firstName,lastName:b.lastName,tel:{countryCode:b.tel.countryCode,areaCode:b.tel.areaCode,number:b.tel.number,extension:b.tel.extension},password:null},a.teltext=a.phoneToText(b.tel)})},a.doEdit=function(){a.edit=!0},a.doSave=function(){null===a.newdata.password?a.error=!0:(a.edit=!1,h(d.currentUser,a.newdata,function(b){b&&a.doLoad()}))},a.doCancel=function(){a.edit=!1,a.error=!1,a.doLoad()},a.phoneToText=function(a){a=a||{countryCode:"",areaCode:"",number:"",extension:""};var b="";return b+="+ "+a.countryCode,a.areaCode&&(b+=" ( "+a.areaCode),a.number&&(b+=" ) "+a.number.toString().split("").slice(0,3).join("")),a.number.toString().length>3&&(b+="-"+a.number.toString().split("").slice(3).join("")),a.extension&&(b+=" ext: "+a.extension),b},a.textToPhone=function(a){var b={};b.countryCode="",b.areaCode="",b.number="",b.extension="";var c=(""+a).replace(/[^0-9]/g,"").split("");return b.countryCode="1",b.areaCode=c.slice(1,4).join(""),b.number=c.slice(4,11).join(""),b.extension=c.slice(11,15).join(""),b},a.checkphone=function(){a.newdata.tel=a.textToPhone(a.teltext),f(function(){a.teltext=a.phoneToText(a.newdata.tel)},0)},a.userdata={},a.edit=!1,a.showJsonData=!1,a.contentExist=!1,a.error=!1,a.doLoad()}]),angular.module("bcApp").constant("apiurl","http://104.236.35.119/api/");